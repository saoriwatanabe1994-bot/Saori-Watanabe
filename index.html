<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>受付</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <p>受付中です…</p>

  <script>
    async function main() {
      await liff.init({ liffId: "2008912129-TQRCpL9d" });

      const params = new URLSearchParams(window.location.search);
      const member = params.get("member");
      const className = params.get("class");

      // 会員QRを読んだとき
      if (member) {
        localStorage.setItem("member", member);
        document.body.innerHTML = "<h2>会員認証OK<br>次にクラスQRを読み取ってください</h2>";
        return;
      }

      // クラスQRを読んだとき
      if (className) {
        const savedMember = localStorage.getItem("member");

        if (!savedMember) {
          document.body.innerHTML = "<h2>先に会員QRを読み取ってください</h2>";
          return;
        }

        let formUrl =
          "https://docs.google.com/forms/d/e/1FAIpQLSfZeKs2ZPJ0iIOxg6L7UZUr7fUmZy-E5OwA7aq93Uu7VaysBA/viewform" +
          "?entry.71375240=" + encodeURIComponent(savedMember) +
          "&entry.403922703=" + encodeURIComponent(className);

        // 次の受付に備えて会員番号は残す（連続受講OK）
        window.location.href = formUrl;
      }
    }

    main();
  </script>
</body>
</html>

