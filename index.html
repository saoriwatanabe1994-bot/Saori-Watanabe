<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>受付</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
    }

    /* 曜日ボタン（小さめ・横並び） */
    .day-btn {
      font-size: 14px;
      padding: 6px 10px;
      margin: 4px 2px;
      opacity: 0.6;
    }

    .day-btn.today {
      opacity: 1;
      background: #66adff;
      color: #fff;
      font-weight: bold;
    }

    /* クラスボタン（大きめ・縦） */
    .class-btn {
      font-size: 20px;
      padding: 18px;
      margin: 10px 0;
      width: 100%;
    }

  /* 受付完了オーバーレイ */
  #complete {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }

  #completeBox {
    background: #fff;
    padding: 50px 40px;
  border-radius: 16px;
  font-size: 36px;
    font-weight: bold;
    text-align: center;
  }

  </style>
</head>

<body>
  <h2 id="title"></h2>

  <div id="dayButtons"></div>
  <div id="container"></div>

  <script>
    async function initLiff() {
  try {
    await liff.init({ liffId: "2008912129-TQRCpL9d" });
  } catch (e) {
    alert("LINEアプリで開いてください");
  }
}

initLiff();

    const params = new URLSearchParams(window.location.search);
    const member = params.get("member");

    const dayMap = ["日", "月", "火", "水", "木", "金", "土"];

    const classes = {
      "月": ["UCCHY初級", "UCCHY中級", "SHINYA", "あすぴ"],
      "火": ["SHO-TA", "KIBE初級", "KIBE中級", "MIZUKI"],
      "水": ["AIRI初級", "AIRI中級", "ruchica"],
      "木": ["SERINAキッズ", "SERINA初中級", "RIN", "Shogo", "心"],
      "金": ["manaキッズ", "mana初級", "KANAMI", "RYUYA", "SAMURAI"],
      "土": ["幼児", "nikoキッズ", "SAORI", "TAKUEI", "愛梨", "MAHIRO初級", "MAHIRO中級"],
      "日": ["2/1キッズ中級", "2/15キッズ中級"]
    };

    const title = document.getElementById("title");
    const container = document.getElementById("container");
    const dayButtons = document.getElementById("dayButtons");

    function renderDayButtons(today) {
      dayButtons.innerHTML = "";
      dayMap.forEach(day => {
        const btn = document.createElement("button");
        btn.textContent = day + "曜";
        btn.className = "day-btn" + (day === today ? " today" : "");
        btn.onclick = () => showClasses(day);
        dayButtons.appendChild(btn);
      });
    }

    function showClasses(day) {
      title.textContent = "本日のクラス（" + day + "曜日）";
      container.innerHTML = "";

      (classes[day] || []).forEach(cls => {
        const btn = document.createElement("button");
        btn.textContent = "受付 ▶" ＋ cls;
        btn.className = "class-btn";
        btn.onclick = () => submit(cls);
        container.appendChild(btn);
      });
    }
let submitting = false; // ★連打防止フラグ
    
    function submit(className) {
      if (submitting) return;   // ★2回目以降は無視
  submitting = true;
      
  const formUrl =
    "https://docs.google.com/forms/d/e/1FAIpQLSfZeKs2ZPJ0iIOxg6L7UZUr7fUmZy-E5OwA7aq93Uu7VaysBA/formResponse" +
    "?entry.71375240=" + encodeURIComponent(member) +
    "&entry.403922703=" + encodeURIComponent(className);

  fetch(formUrl, { method: "POST", mode: "no-cors" });

  container.innerHTML = "";
dayButtons.innerHTML = "";
title.textContent = "";


  // ▼ 受付完了表示
  document.getElementById("complete").style.display = "flex";

    // ▼ 念のためボタン全部無効化
  document.querySelectorAll("button").forEach(btn => {
    btn.disabled = true;
  }); 

  // ▼ 1.2秒後に自動で閉じる
  setTimeout(() => {
    liff.closeWindow();
  }, 1200);
}

    const today = dayMap[new Date().getDay()];
    renderDayButtons(today);
    showClasses(today);
  </script>
  <div id="complete">
  <div id="completeBox">✅ 受付完了<br>
  次の会員を読み取ってください</div>
</div>

</body>
</html>

