<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>受付（手入力）</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body { font-family: sans-serif; padding: 12px; }

    /* 入力 */
    .input-box { margin: 10px 0 14px; }
    input[type="text"]{
      font-size: 22px;
      padding: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    // 会員番号：数字のみ・全角→半角 自動変換
memberInput.addEventListener("input", () => {
  let v = memberInput.value;

  // 全角数字 → 半角数字
  v = v.replace(/[０-９]/g, s =>
    String.fromCharCode(s.charCodeAt(0) - 0xFEE0)
  );

  // 数字以外を削除
  v = v.replace(/[^0-9]/g, "");

  memberInput.value = v;
});


    /* 曜日ボタン（小さめ） */
    .day-btn {
      font-size: 14px;
      padding: 6px 10px;
      margin: 4px 2px;
      opacity: 0.7;
    }
    .day-btn.today {
      opacity: 1;
      background: #66adff;
      color: #fff;
      font-weight: bold;
    }

    /* クラスボタン（大きめ・縦） */
    .class-btn {
      font-size: 20px;
      padding: 28px 18px;      /* ←縦幅を広げたいならここを増やす */
      margin: 12px 0;
      width: 100%;
      text-align: left;
    }

    /* 受付完了オーバーレイ */
    #complete {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    #completeBox {
      background: #fff;
      padding: 44px 34px;
      border-radius: 18px;
      text-align: center;
      width: 90%;
      max-width: 420px;
    }
    #completeBox .done {
      font-size: 38px;
      font-weight: 800;
      margin-bottom: 12px;
    }
    #completeBox .detail {
      font-size: 18px;
      line-height: 1.5;
      word-break: break-word;
    }

    /* 画面セクション */
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>

<body>
  <h2 id="title">会員番号を入力してください</h2>

  <!-- ① 会員番号入力画面 -->
  <div id="sectionInput" class="section active">
    <div class="input-box">
      <input
  id="memberInput"
  type="text"
  inputmode="numeric"
  pattern="[0-9]*"
  placeholder="会員番号（数字のみ）"
/>
    </div>
    <button id="goBtn" class="class-btn" style="text-align:center;">次へ（クラス選択）</button>
  </div>

  <!-- ② クラス選択画面 -->
  <div id="sectionSelect" class="section">
    <div id="dayButtons"></div>
    <div id="container"></div>
    <button id="backBtn" class="day-btn" style="margin-top:10px;">← 会員番号入力に戻る</button>
  </div>

  <!-- 完了オーバーレイ -->
  <div id="complete">
    <div id="completeBox">
      <div class="done">✅ 受付完了</div>
      <div class="detail" id="completeDetail"></div>
    </div>
  </div>

  <script>
    // ====== 設定 ======
    const LIFF_ID = "2008912129-TQRCpL9d";
    const FORM_RESPONSE =
      "https://docs.google.com/forms/d/e/1FAIpQLSfZeKs2ZPJ0iIOxg6L7UZUr7fUmZy-E5OwA7aq93Uu7VaysBA/formResponse";
    const ENTRY_MEMBER = "entry.71375240";
    const ENTRY_CLASS  = "entry.403922703";

    // クラス定義
    const classes = {
      "月": ["UCCHY初級", "UCCHY中級", "SHINYA", "あすぴ"],
      "火": ["SHO-TA", "KIBE初級", "KIBE中級", "MIZUKI"],
      "水": ["AIRI初級", "AIRI中級", "ruchica"],
      "木": ["SERINAキッズ", "SERINA初中級", "RIN", "Shogo", "心"],
      "金": ["manaキッズ", "mana初級", "KANAMI", "RYUYA", "SAMURAI"],
      "土": ["幼児", "nikoキッズ", "SAORI", "TAKUEI", "愛梨", "MAHIRO初級", "MAHIRO中級"],
      "日": ["2/1キッズ中級", "2/15キッズ中級"]
    };
    const dayMap = ["日","月","火","水","木","金","土"];

    // ====== 要素 ======
    const title = document.getElementById("title");
    const memberInput = document.getElementById("memberInput");
    const goBtn = document.getElementById("goBtn");
    const backBtn = document.getElementById("backBtn");
    const dayButtons = document.getElementById("dayButtons");
    const container = document.getElementById("container");
    const complete = document.getElementById("complete");
    const completeDetail = document.getElementById("completeDetail");

    const sectionInput = document.getElementById("sectionInput");
    const sectionSelect = document.getElementById("sectionSelect");

    let currentMember = "";
    let submitting = false;

    // ====== 画面切替 ======
    function showInputScreen() {
      sectionSelect.classList.remove("active");
      sectionInput.classList.add("active");
      title.textContent = "会員番号を入力してください";
      currentMember = "";
      submitting = false;
      memberInput.value = "";
      setTimeout(() => memberInput.focus(), 50);
    }

    function showSelectScreen() {
      sectionInput.classList.remove("active");
      sectionSelect.classList.add("active");
      // 今日の曜日
      const today = dayMap[new Date().getDay()];
      renderDayButtons(today);
      showClasses(today);
    }

    // ====== 曜日ボタン ======
    function renderDayButtons(today) {
      dayButtons.innerHTML = "";
      dayMap.forEach(day => {
        const btn = document.createElement("button");
        btn.textContent = day + "曜";
        btn.className = "day-btn" + (day === today ? " today" : "");
        btn.onclick = () => showClasses(day);
        dayButtons.appendChild(btn);
      });
    }

    // ====== クラス表示 ======
    function showClasses(day) {
      title.textContent = "本日のクラス（" + day + "曜日）";
      container.innerHTML = "";

      (classes[day] || []).forEach(cls => {
        const btn = document.createElement("button");
        btn.textContent = "受付 ▶ " + cls;
        btn.className = "class-btn";
        btn.onclick = () => submit(cls);
        container.appendChild(btn);
      });
    }

    // ====== 送信 ======
    function submit(className) {
      if (submitting) return;
      submitting = true;

      const url = FORM_RESPONSE
        + "?" + ENTRY_MEMBER + "=" + encodeURIComponent(currentMember)
        + "&" + ENTRY_CLASS  + "=" + encodeURIComponent(className);

      fetch(url, { method: "POST", mode: "no-cors" });

      // 完了画面に「クラス名」表示
      completeDetail.innerHTML =
        "会員番号：<b>" + escapeHtml(currentMember) + "</b><br>" +
        "クラス：<b>" + escapeHtml(className) + "</b><br><br>" +
        "次の会員を入力してください";

      complete.style.display = "flex";

      // 1.2秒後に入力画面へ自動復帰
      setTimeout(() => {
        complete.style.display = "none";
        showInputScreen();
      }, 1200);
    }

    // HTMLエスケープ（念のため）
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ====== ボタン動作 ======
    goBtn.onclick = () => {
  const v = memberInput.value.trim();

  if (!v) {
    alert("会員番号を入力してください");
    return;
  }

  currentMember = v;
  showSelectScreen();
};


    backBtn.onclick = () => showInputScreen();

    // ====== LIFF init（LINE内推奨。ブラウザでも動くが警告） ======
    (async () => {
      try {
        await liff.init({ liffId: LIFF_ID });
      } catch (e) {
        // LINE外でも使えるように、ここでは止めない
        // alert("LINEアプリで開くと安定します");
      }
      showInputScreen();
    })();
  </script>
</body>
</html>
